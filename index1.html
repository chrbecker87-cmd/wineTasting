<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Nils & Chris – Grand Cru Classé Tasting (Standalone)</title>
<style>
 :root{
  --bg:#fafafa; --txt:#111; --muted:#6b7280; --ring:#e5e7eb;
  --card:#ffffff; --card-green:#ecfdf5; --ring-green:#a7f3d0;
  --rose-bg:#fff1f2; --rose:#9f1239; --amber:#b45309; --emerald:#065f46;
}

/* Basis */
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","SF Pro Display","Segoe UI",Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";}
html{-webkit-text-size-adjust:100%;}
body{margin:0;background:var(--bg);color:var(--txt);}

/* Layout */
.container{max-width:1120px;margin:0 auto;padding:24px;}
header{
  background:linear-gradient(#f9fafb,#fff1f2 40%,#fafafa);
  padding:24px 16px 12px;
}
h1{margin:0 0 8px 0;font-weight:700;letter-spacing:.2px;}
.muted{color:var(--muted)}
.small{font-size:12px}

/* Fortschritt */
.progress{height:8px;background:#eee;border-radius:999px;overflow:hidden}
.progress>div{height:100%;background:#111;transform-origin:left}

/* Controls */
.controls{display:grid;grid-template-columns:1fr 220px auto;gap:12px;margin:18px 0}
.input,.select{
  width:100%;padding:10px 12px;border:1px solid var(--ring);border-radius:12px;background:#fff;
  font-size:16px; /* iOS: kein Zoom */
  min-height:44px;
}
.switch{
  display:flex;align-items:center;gap:10px;padding:10px 12px;border:1px solid var(--ring);border-radius:12px;background:#fff;
  min-height:44px;font-size:16px;
}

/* Grid & Cards */
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
.card{
  border:1px solid var(--ring);border-radius:16px;background:var(--card);
  padding:12px;transition:.15s box-shadow,.15s transform;min-height:210px;
}
.card:hover{box-shadow:0 4px 18px rgba(0,0,0,.06);transform:translateY(-1px)}
.card.tasted{background:var(--card-green);border-color:var(--ring-green)}

/* Card Header */
.title{display:flex;align-items:flex-start;justify-content:space-between;gap:8px;position:relative}
.title h3{
  margin:2px 0 0 0;font-size:18px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;min-width:0
}
.badge{
  white-space:nowrap;flex-shrink:0;background:var(--rose-bg);color:var(--rose);
  border:1px solid #fecdd3;border-radius:999px;padding:2px 8px;font-size:12px
}

/* Meta & Text-Clamp */
.meta{margin-top:4px}
.clamp-2{
  display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;
}

/* Rows */
.row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
.row label{align-self:center;font-size:14px}
.score{display:flex;align-items:center;gap:8px}
.score input{
  width:100%;padding:8px 10px;border:1px solid var(--ring);border-radius:10px;font-size:16px;min-height:44px;
}

/* iOS Date Input hübscher + konsistent */
input[type="date"]{
  appearance:none;-webkit-appearance:none;background:#fff;border:1px solid var(--ring);
  border-radius:12px;padding:8px 10px;font-size:16px;min-height:44px;line-height:1.2;
}

/* Statuszeile */
.status{display:flex;align-items:center;justify-content:space-between;margin-top:10px;font-size:14px;gap:8px;flex-wrap:wrap}
.green{color:var(--emerald);font-weight:600}
.amber{color:var(--amber);font-weight:600}

/* Footer */
.footer-quote{margin-top:24px;padding:16px;border:1px solid var(--ring);border-radius:16px;background:#fff;text-align:center}

/* ---------- Mobile Tweaks ---------- */
@media (max-width:900px){
  .controls{grid-template-columns:1fr}
  .container{padding:18px 16px}
}

@media (max-width:480px){
  header{padding:18px 12px 10px}
  h1{font-size:28px;line-height:1.15;margin-bottom:6px}
  .muted{font-size:15px}
  .progress{height:6px}
  .controls{gap:10px;margin:14px 0}
  .grid{grid-template-columns:1fr;gap:12px}
  .card{padding:12px 12px 14px;min-height:200px}
  .title h3{font-size:20px}
  .row{grid-template-columns:1fr;gap:8px}
  .footer-quote{margin-top:18px;padding:14px}
  /* Platz fürs iOS Bottom-Safe-Area */
  body{padding-bottom:calc(env(safe-area-inset-bottom,0) + 12px)}
}

</style>


</head>
<body>

<header>
  <div class="container" style="text-align:center;padding:28px 16px">
    <h1 style="font-size:28px">Nils & Chris – Grand Cru Classé Tasting</h1>
    <div class="muted">Eine Lebensaufgabe: jeden Grand Cru Classé einmal gemeinsam verkosten.</div>
    <div style="max-width:560px;margin:16px auto 0">
      <div class="progress"><div id="progressBar" style="width:0%"></div></div>
      <div id="progressText" class="muted small" style="margin-top:6px">Fortschritt: 0/0 (0%)</div>
    </div>
  </div>
</header>

<section class="container">
  <div class="controls">
    <input id="search" class="input" placeholder="Suche nach Château, Herkunftsgebiet oder Rebsorten…" />
    <select id="klass" class="select">
      <option>Alle</option><option>1er Cru</option><option>2e Cru</option>
      <option>3e Cru</option><option>4e Cru</option><option>5e Cru</option>
    </select>
    <label class="switch"><input type="checkbox" id="onlyTasted" /> Nur verkostete zeigen</label>
  </div>

  <div id="grid" class="grid"></div>

  <div id="empty" class="muted" style="text-align:center;display:none;margin:40px 0">
    Keine Einträge gefunden.
  </div>

  <div class="footer-quote" style="text-align:center">
    <em>„Wuff Wuff“</em>
    <div class="muted" style="margin-top:6px">Nils Trabold</div>
  </div>
</section>

<script>
(function(){
  const LS_KEY = "grandcru-nilschris-standalone-v1";

  // ---------- Helpers ----------
  function hasValidDate(v){
    if(!v) return false;
    return /^\d{4}-\d{2}-\d{2}$/.test(v) || /^\d{2}\.\d{2}\.\d{4}$/.test(v);
  }
  function formatDateTTMMJJJJ(value){
    if(!value) return "";
    const m = /^(\d{4})-(\d{2})-(\d{2})$/.exec(value);
    if(m){ return m[3]+"."+m[2]+"."+m[1]; }
    const d = new Date(value);
    if(isNaN(d)) return "";
    const dd = String(d.getDate()).padStart(2,"0");
    const mm = String(d.getMonth()+1).padStart(2,"0");
    const yy = d.getFullYear();
    return dd+"."+mm+"."+yy;
  }
  function clampScore(v){
    if(v===""||v==null) return "";
    let n = parseInt(v,10);
    if(isNaN(n)) return "";
    if(n<0) n=0; if(n>100) n=100;
    return String(n);
  }
  function averageScore(a,b){
    const na = (a===""||a==null) ? NaN : parseInt(a,10);
    const nb = (b===""||b==null) ? NaN : parseInt(b,10);
    if(isNaN(na) && isNaN(nb)) return "";
    if(isNaN(na)) return String(nb);
    if(isNaN(nb)) return String(na);
    return String(Math.round((na+nb)/2));
  }

  // ---------- Datenbasis ----------
  const FULL_DATA = [
  // 1er (5)
  { château:"Château Lafite Rothschild", klassifikation:"1er Cru", herkunftsgebiet:"Pauillac", rebsorten:"91% Cabernet Sauvignon, 8% Merlot, 1% Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Latour", klassifikation:"1er Cru", herkunftsgebiet:"Pauillac", rebsorten:"90% Cabernet Sauvignon, 9% Merlot, 1% Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Margaux", klassifikation:"1er Cru", herkunftsgebiet:"Margaux", rebsorten:"89% Cabernet Sauvignon, 8% Merlot, 3% Cabernet Franc/Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Haut-Brion", klassifikation:"1er Cru", herkunftsgebiet:"Pessac-Léognan", rebsorten:"55% Merlot, 37% Cabernet Sauvignon, 8% Cabernet Franc", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Mouton Rothschild", klassifikation:"1er Cru", herkunftsgebiet:"Pauillac", rebsorten:"80% Cabernet Sauvignon, 16% Merlot, 4% Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },

  // 2e
  { château:"Château Léoville-Las Cases", klassifikation:"2e Cru", herkunftsgebiet:"Saint-Julien", rebsorten:"80% Cabernet Sauvignon, 11% Cabernet Franc, 9% Merlot", verkostetAm:"19.09.2025", scoreNils:"100", scoreChris:"100" },
  { château:"Château Léoville-Poyferré", klassifikation:"2e Cru", herkunftsgebiet:"Saint-Julien", rebsorten:"65% Cabernet Sauvignon, 25% Merlot, 8% Petit Verdot, 2% Cabernet Franc", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Léoville-Barton", klassifikation:"2e Cru", herkunftsgebiet:"Saint-Julien", rebsorten:"83% Cabernet Sauvignon, 15% Merlot, 2% Cabernet Franc", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Gruaud-Larose", klassifikation:"2e Cru", herkunftsgebiet:"Saint-Julien", rebsorten:"60% Cabernet Sauvignon, 30% Merlot, 10% Cabernet Franc", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Ducru-Beaucaillou", klassifikation:"2e Cru", herkunftsgebiet:"Saint-Julien", rebsorten:"90% Cabernet Sauvignon, 10% Merlot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Rauzan-Ségla", klassifikation:"2e Cru", herkunftsgebiet:"Margaux", rebsorten:"62% Cabernet Sauvignon, 35% Merlot, 3% Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Rauzan-Gassies", klassifikation:"2e Cru", herkunftsgebiet:"Margaux", rebsorten:"65% Cabernet Sauvignon, 28% Merlot, 7% Cabernet Franc", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Durfort-Vivens", klassifikation:"2e Cru", herkunftsgebiet:"Margaux", rebsorten:"70% Cabernet Sauvignon, 24% Merlot, 6% Cabernet Franc", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Lascombes", klassifikation:"2e Cru", herkunftsgebiet:"Margaux", rebsorten:"50% Cabernet Sauvignon, 45% Merlot, 5% Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Brane-Cantenac", klassifikation:"2e Cru", herkunftsgebiet:"Margaux", rebsorten:"55% Cabernet Sauvignon, 40% Merlot, 5% Cabernet Franc", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Pichon Baron", klassifikation:"2e Cru", herkunftsgebiet:"Pauillac", rebsorten:"80% Cabernet Sauvignon, 20% Merlot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Pichon Comtesse de Lalande", klassifikation:"2e Cru", herkunftsgebiet:"Pauillac", rebsorten:"75% Cabernet Sauvignon, 25% Merlot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Cos d’Estournel", klassifikation:"2e Cru", herkunftsgebiet:"Saint-Estèphe", rebsorten:"76% Cabernet Sauvignon, 23% Merlot, 1% Cabernet Franc", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Montrose", klassifikation:"2e Cru", herkunftsgebiet:"Saint-Estèphe", rebsorten:"68% Cabernet Sauvignon, 25% Merlot, 7% Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },

  // 3e (14)
  { château:"Château Kirwan", klassifikation:"3e Cru", herkunftsgebiet:"Margaux", rebsorten:"45% Cabernet Sauvignon, 30% Merlot, 25% Cabernet Franc/Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château d’Issan", klassifikation:"3e Cru", herkunftsgebiet:"Margaux", rebsorten:"60% Cabernet Sauvignon, 40% Merlot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Giscours", klassifikation:"3e Cru", herkunftsgebiet:"Margaux", rebsorten:"65% Cabernet Sauvignon, 30% Merlot, 5% Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Malescot St-Exupéry", klassifikation:"3e Cru", herkunftsgebiet:"Margaux", rebsorten:"50% Cabernet Sauvignon, 35% Merlot, 10% Cabernet Franc, 5% Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Cantenac-Brown", klassifikation:"3e Cru", herkunftsgebiet:"Margaux", rebsorten:"65% Cabernet Sauvignon, 30% Merlot, 5% Cabernet Franc", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Boyd-Cantenac", klassifikation:"3e Cru", herkunftsgebiet:"Margaux", rebsorten:"70% Cabernet Sauvignon, 25% Merlot, 5% Cabernet Franc", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Palmer", klassifikation:"3e Cru", herkunftsgebiet:"Margaux", rebsorten:"47% Cabernet Sauvignon, 47% Merlot, 6% Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Desmirail", klassifikation:"3e Cru", herkunftsgebiet:"Margaux", rebsorten:"60% Cabernet Sauvignon, 35% Merlot, 5% Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Ferrière", klassifikation:"3e Cru", herkunftsgebiet:"Margaux", rebsorten:"70% Cabernet Sauvignon, 25% Merlot, 5% Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Marquis d’Alesme Becker", klassifikation:"3e Cru", herkunftsgebiet:"Margaux", rebsorten:"60% Cabernet Sauvignon, 30% Merlot, 10% Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Lagrange", klassifikation:"3e Cru", herkunftsgebiet:"Saint-Julien", rebsorten:"70% Cabernet Sauvignon, 25% Merlot, 5% Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Langoa Barton", klassifikation:"3e Cru", herkunftsgebiet:"Saint-Julien", rebsorten:"57% Cabernet Sauvignon, 34% Merlot, 9% Cabernet Franc", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Calon-Ségur", klassifikation:"3e Cru", herkunftsgebiet:"Saint-Estèphe", rebsorten:"60% Cabernet Sauvignon, 30% Merlot, 10% Cabernet Franc", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château La Lagune", klassifikation:"3e Cru", herkunftsgebiet:"Haut-Médoc", rebsorten:"60% Cabernet Sauvignon, 30% Merlot, 10% Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },

  // 4e (10)
  { château:"Château Saint-Pierre", klassifikation:"4e Cru", herkunftsgebiet:"Saint-Julien", rebsorten:"75% Cabernet Sauvignon, 15% Merlot, 10% Cabernet Franc", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Talbot", klassifikation:"4e Cru", herkunftsgebiet:"Saint-Julien", rebsorten:"66% Cabernet Sauvignon, 26% Merlot, 8% Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Branaire-Ducru", klassifikation:"4e Cru", herkunftsgebiet:"Saint-Julien", rebsorten:"70% Cabernet Sauvignon, 22% Merlot, 5% Cabernet Franc, 3% Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Beychevelle", klassifikation:"4e Cru", herkunftsgebiet:"Saint-Julien", rebsorten:"52% Cabernet Sauvignon, 40% Merlot, 8% Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Marquis de Terme", klassifikation:"4e Cru", herkunftsgebiet:"Margaux", rebsorten:"60% Cabernet Sauvignon, 35% Merlot, 5% Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Pouget", klassifikation:"4e Cru", herkunftsgebiet:"Margaux", rebsorten:"60% Cabernet Sauvignon, 35% Merlot, 5% Cabernet Franc", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Prieuré-Lichine", klassifikation:"4e Cru", herkunftsgebiet:"Margaux", rebsorten:"70% Cabernet Sauvignon, 25% Merlot, 5% Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Duhart-Milon", klassifikation:"4e Cru", herkunftsgebiet:"Pauillac", rebsorten:"67% Cabernet Sauvignon, 33% Merlot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Lafon-Rochet", klassifikation:"4e Cru", herkunftsgebiet:"Saint-Estèphe", rebsorten:"54% Cabernet Sauvignon, 40% Merlot, 4% Cabernet Franc, 2% Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château La Tour Carnet", klassifikation:"4e Cru", herkunftsgebiet:"Haut-Médoc", rebsorten:"60% Merlot, 37% Cabernet Sauvignon, 3% Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },

  // 5e (18)
  { château:"Château Pontet-Canet", klassifikation:"5e Cru", herkunftsgebiet:"Pauillac", rebsorten:"62% Cabernet Sauvignon, 32% Merlot, 4% Cabernet Franc, 2% Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Batailley", klassifikation:"5e Cru", herkunftsgebiet:"Pauillac", rebsorten:"70% Cabernet Sauvignon, 25% Merlot, 3% Cabernet Franc, 2% Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Haut-Batailley", klassifikation:"5e Cru", herkunftsgebiet:"Pauillac", rebsorten:"65% Cabernet Sauvignon, 25% Merlot, 10% Cabernet Franc", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Grand-Puy-Lacoste", klassifikation:"5e Cru", herkunftsgebiet:"Pauillac", rebsorten:"80% Cabernet Sauvignon, 20% Merlot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Grand-Puy-Ducasse", klassifikation:"5e Cru", herkunftsgebiet:"Pauillac", rebsorten:"60% Cabernet Sauvignon, 35% Merlot, 5% Cabernet Franc", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Lynch-Bages", klassifikation:"5e Cru", herkunftsgebiet:"Pauillac", rebsorten:"75% Cabernet Sauvignon, 15% Merlot, 10% Cabernet Franc", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Lynch-Moussas", klassifikation:"5e Cru", herkunftsgebiet:"Pauillac", rebsorten:"70% Cabernet Sauvignon, 27% Merlot, 3% Cabernet Franc", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château d’Armailhac", klassifikation:"5e Cru", herkunftsgebiet:"Pauillac", rebsorten:"60% Cabernet Sauvignon, 29% Merlot, 9% Cabernet Franc, 2% Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Pédesclaux", klassifikation:"5e Cru", herkunftsgebiet:"Pauillac", rebsorten:"65% Cabernet Sauvignon, 25% Merlot, 10% Cabernet Franc", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Clerc-Milon", klassifikation:"5e Cru", herkunftsgebiet:"Pauillac", rebsorten:"50% Cabernet Sauvignon, 35% Merlot, 10% Cabernet Franc, 5% Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Croizet-Bages", klassifikation:"5e Cru", herkunftsgebiet:"Pauillac", rebsorten:"70% Cabernet Sauvignon, 30% Merlot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Haut-Bages Libéral", klassifikation:"5e Cru", herkunftsgebiet:"Pauillac", rebsorten:"70% Cabernet Sauvignon, 30% Merlot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Dauzac", klassifikation:"5e Cru", herkunftsgebiet:"Margaux", rebsorten:"60% Cabernet Sauvignon, 40% Merlot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château du Tertre", klassifikation:"5e Cru", herkunftsgebiet:"Margaux", rebsorten:"43% Cabernet Sauvignon, 33% Merlot, 19% Cabernet Franc, 5% Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Belgrave", klassifikation:"5e Cru", herkunftsgebiet:"Haut-Médoc", rebsorten:"50% Cabernet Sauvignon, 40% Merlot, 10% Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Camensac", klassifikation:"5e Cru", herkunftsgebiet:"Haut-Médoc", rebsorten:"60% Cabernet Sauvignon, 40% Merlot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Cantemerle", klassifikation:"5e Cru", herkunftsgebiet:"Haut-Médoc", rebsorten:"60% Cabernet Sauvignon, 30% Merlot, 10% Cabernet Franc/Petit Verdot", verkostetAm:"", scoreNils:"", scoreChris:"" },
  { château:"Château Cos Labory", klassifikation:"5e Cru", herkunftsgebiet:"Saint-Estèphe", rebsorten:"55% Cabernet Sauvignon, 35% Merlot, 10% Cabernet Franc", verkostetAm:"", scoreNils:"", scoreChris:"" },
  ].map((w,i)=>({ ...w, _order:i }));

  // ---------- State laden ----------
  let data = FULL_DATA;
  try {
    const raw = localStorage.getItem(LS_KEY);
    if(raw){
      const parsed = JSON.parse(raw);
      data = parsed.map((w,i)=>({ _order:i, ...w }));
    }
  } catch {}

  // ---------- DOM refs ----------
  const elGrid = document.getElementById("grid");
  const elEmpty = document.getElementById("empty");
  const elSearch = document.getElementById("search");
  const elKlass = document.getElementById("klass");
  const elOnlyTasted = document.getElementById("onlyTasted");
  const elProgressBar = document.getElementById("progressBar");
  const elProgressText = document.getElementById("progressText");

  // ---------- Filter UI ----------
  elSearch.addEventListener("input", render);
  elKlass.addEventListener("change", render);
  elOnlyTasted.addEventListener("change", render);

  function save(){ localStorage.setItem(LS_KEY, JSON.stringify(data)); }

  function render(){
    const q = elSearch.value.trim().toLowerCase();
    const klass = elKlass.value;
    const onlyTasted = elOnlyTasted.checked;

    const filtered = data
      .filter(w => klass==="Alle" || w.klassifikation===klass)
      .filter(w => !onlyTasted || hasValidDate(w.verkostetAm))
      .filter(w => q? (w.château+w.herkunftsgebiet+w.rebsorten).toLowerCase().includes(q) : true)
      .slice().sort((a,b)=>(a._order??0)-(b._order??0));

    elGrid.innerHTML = "";
    if(filtered.length===0){ elEmpty.style.display="block"; } else { elEmpty.style.display="none"; }

    filtered.forEach(w=>{
      const card = document.createElement("div");
      card.className = "card" + (hasValidDate(w.verkostetAm) ? " tasted" : "");

      // Header
      const head = document.createElement("div");
      head.className = "title";
      const h3 = document.createElement("h3");
      h3.textContent = w.château;
      const badge = document.createElement("div");
      badge.className = "badge"; badge.textContent = w.klassifikation;
      head.appendChild(h3); head.appendChild(badge);

      const loc = document.createElement("div");
      loc.className="muted small";
      loc.textContent = w.herkunftsgebiet;

      // Rebsorten
      const grapes = document.createElement("div");
      grapes.className = "small";
      grapes.innerHTML = "<strong>Rebsorten:</strong> " + w.rebsorten;

      // Datum
      const rowDate = document.createElement("div");
      rowDate.className = "row";
      const lblDate = document.createElement("label");
      lblDate.textContent = "Verkostet am";
      const inputDate = document.createElement("input");
      inputDate.className = "input";
      inputDate.type = "date";
      inputDate.value = /^\d{4}-\d{2}-\d{2}$/.test(w.verkostetAm||"") ? w.verkostetAm : "";
      inputDate.addEventListener("change", (e)=>{
        w.verkostetAm = e.target.value || "";
        save(); render();
      });
      rowDate.appendChild(lblDate); rowDate.appendChild(inputDate);

      // Scores
      const rowScore = document.createElement("div");
      rowScore.className = "row";
      const s1 = document.createElement("div");
      s1.className = "score";
      const l1 = document.createElement("label"); l1.textContent="Nils"; l1.style.width="60px";
      const i1 = document.createElement("input");
      i1.type="number"; i1.min="0"; i1.max="100"; i1.placeholder="0–100"; i1.value = w.scoreNils || "";
      i1.addEventListener("input",(e)=>{ w.scoreNils = e.target.value; save(); updateStatus(); });
      i1.addEventListener("blur",(e)=>{ w.scoreNils = clampScore(e.target.value); e.target.value=w.scoreNils; save(); updateStatus(); });

      const s2 = document.createElement("div");
      s2.className = "score";
      const l2 = document.createElement("label"); l2.textContent="Chris"; l2.style.width="60px";
      const i2 = document.createElement("input");
      i2.type="number"; i2.min="0"; i2.max="100"; i2.placeholder="0–100"; i2.value = w.scoreChris || "";
      i2.addEventListener("input",(e)=>{ w.scoreChris = e.target.value; save(); updateStatus(); });
      i2.addEventListener("blur",(e)=>{ w.scoreChris = clampScore(e.target.value); e.target.value=w.scoreChris; save(); updateStatus(); });

      s1.appendChild(l1); s1.appendChild(i1);
      s2.appendChild(l2); s2.appendChild(i2);
      rowScore.appendChild(s1); rowScore.appendChild(s2);

      // Statuszeile
      const status = document.createElement("div");
      status.className = "status";
      const left = document.createElement("div");
      const right = document.createElement("div"); right.className="amber";

      function updateStatus(){
        card.className = "card" + (hasValidDate(w.verkostetAm) ? " tasted" : "");
        left.className = hasValidDate(w.verkostetAm) ? "green" : "muted";
        left.textContent = hasValidDate(w.verkostetAm)
          ? "Verkostet am " + formatDateTTMMJJJJ(w.verkostetAm)
          : "Noch nicht verkostet";
        const avg = averageScore(w.scoreNils||"", w.scoreChris||"");
        right.textContent = (w.scoreNils||w.scoreChris) ? (avg ? "Ø "+avg+"/100" : (w.scoreNils||w.scoreChris)+"/100") : "";
        updateProgress();
      }
      updateStatus();

      status.appendChild(left); status.appendChild(right);

      // zusammenbauen
      card.appendChild(head);
      card.appendChild(loc);
      card.appendChild(grapes);
      card.appendChild(rowDate);
      card.appendChild(rowScore);
      card.appendChild(status);
      elGrid.appendChild(card);
    });

    updateProgress();
  }

  function updateProgress(){
    const total = data.length || 1;
    const tasted = data.filter(w=>hasValidDate(w.verkostetAm)).length;
    const pct = Math.round((tasted/total)*100);
    elProgressBar.style.width = pct + "%";
    elProgressText.textContent = `Fortschritt: ${tasted}/${data.length} Weine (${pct}%)`;
  }

  render();
})();
</script>
</body>
</html>







